create table t1 (a int) engine=myisam;
insert into t1 values (3), (7), (1);
update (select a from t1) as t set a=10;
select * from t1;
create view v1 as select a from t1;
show create view v1;
update v1 set a=12;
select * from t1;
update (select * from t1) as t set a=14;
select * from t1;
update (select * from t1) as t set t.a=18 limit 1;
select * from t1;
update (select * from t1) as t set t.a=2 where a < 18;
select * from t1;
update (select * from (select * from t1) as t) as tt set tt.a=22 where a > 18;
select * from t1;
update (select * from (select * from t1) as t where t.a > 20) as tt set tt.a=24; 
select * from t1;
create view v2 as select * from v1 where v1.a < 10;
create view v3 as select * from v2;
update t1 set a=10 limit 1;
select * from t1;
update t1 set a=7  where a > 10;
select * from t1;
update v3 set a=6;
select * from t1;
update (select * from (select * from t1) as t where t.a < 10) as tt set tt.a=2;
select * from t1;
update t1 set a=5 where a < 10 limit 1;
select * from t1;
update (select * from (select * from t1 where t1.a > 2) as t where t.a < 10) as tt set tt.a=4; 
select * from t1;
create view v4 as select * from (select * from t1) t where t.a < 10;
show create view v4;
select * from v4;
create view v5 as select a as b from v1 where v1.a < 10;
show create view v5;
drop view v4;
create view v4 as select * from (select a as b from t1) t where t.b < 10;
show create view v4;
select * from v4;
delete from t1;
insert into t1 values (3),(7),(1);
update v4 set v4.b=12 where v4.b > 5;
select * from t1;
update v5 set v5.b=12 where v5.b < 3;
select * from t1;
create view v6 as select * from (select a as b from t1) t where t.b < 10 with check option;
show create view v6;
create view v7 as select a as b from v1 where v1.a < 10 with check option;
show create view v7;
show create view v7;
-- error ER_VIEW_CHECK_FAILED
update v7 set v7.b=20 where v7.b < 5;
-- error ER_VIEW_CHECK_FAILED
update v6 set v6.b=15 where v6.b < 5;
update (select * from v6 where v6.b < 5) t set t.b=7;
select * from t1;

drop view v1,v2,v3,v4,v5,v6,v7;
drop table t1;

