create table t1 (a int) engine=myisam;
insert into t1 values (3), (7), (1);
with cte1 as (select a from t1) update cte1 set a=10;
select * from t1;
with cte1 as (select * from t1) update cte1 set a=14;
select * from t1;
with cte1 as (select * from t1) update cte1 set cte1.a=18 limit 1;
select * from t1;
with cte1 as (select * from t1) update cte1 set cte1.a=2 where a<18;
select * from t1;
with cte1 as (select * from (select * from t1) dt1)
update cte1 set cte1.a=22 where a>18;
select * from t1;
with cte1 as (select * from (select * from t1) dt1 where dt1.a > 17)
update cte1 set cte1.a=24;
select * from t1;
create view v1 as select * from t1 where t1.a < 10;
create view v2 as select * from v1;
update v2 set a=6;
select * from t1;
with cte1 as (select * from (select * from t1 where t1.a > 2) dt1 where dt1.a < 24)
update cte1 set cte1.a=4 limit 1;
select * from t1;
drop view v1, v2;
drop table t1;

create table t1 (a int);
insert into t1 values (1),(2),(3),(4),(7),(10);
create table t2 (b int);
insert into t2 values (4),(7),(1),(3),(11);
select * from t1;
select * from t2;

--echo # CTEs with DTs - UPDATE
with cte1 as (select * from t1 where a <2) update cte1 set a=0;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from t1 where a>2) update cte1 set a=0 where a<10;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from (select * from t1) dt1) update cte1 set a=1 where a>2;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from (select * from t1) dt1 where a>1)
update cte1 set a=9 where a>2;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from (select * from (select * from t1) dt1) dt2)
update cte1 set a=2 where a>7;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from (select * from (select * from t1) dt1) dt2 where a<8)
update cte1 set a=2 where a>3;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from (select * from (select * from t1) dt1 where a>1) dt2 where a<11)
update cte1 set a=2 where a>6;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from t1),
cte2 as (select * from cte1) update cte2 set a=9 where a>5;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from t1 where a>2),
cte2 as (select * from cte1 where a>3) update cte2 set a=9 where a<9;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from (select * from t1) dt1),
cte2 as (select * from cte1) update cte2 set a=9 where a>3;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
with cte1 as (select * from (select * from t1) dt1 where a>2),
cte2 as (select * from cte1 where a>3) update cte2 set a=9 where a<9;
select * from t1;
delete from t1; insert into t1 values (1),(2),(3),(4),(7),(10);
drop table t1, t2;
drop view v1, v2, v3, v4;